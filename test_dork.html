<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Dorking & OSINT Workbench</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;700&family=Inter:wght@300;400;700&display=swap');

        :root {
            --bg-color: #1a1a2e;
            --card-bg: #21213e;
            --text-color: #e0e0e0;
            --primary-color: #0f4c75;
            --accent-color: #3282b8;
            --border-color: #3e3e5c;
            --success-color: #4CAF50;
            --error-color: #f44336;
            --info-color: #ffa500; /* Orange for hints/info */
            --font-mono: 'Fira Code', monospace;
            --font-sans: 'Inter', sans-serif;
            --transition-speed: 0.3s ease;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--font-sans);
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            width: 100%;
        }

        header h1 {
            color: var(--accent-color);
            margin-bottom: 10px;
            font-size: 2.8em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        header p {
            font-size: 1.2em;
            max-width: 900px;
            margin: 0 auto;
        }

        .disclaimer {
            font-size: 0.9em;
            color: var(--error-color);
            margin-top: 20px;
            padding: 15px;
            border: 1px solid var(--error-color);
            border-radius: 8px;
            background-color: rgba(244, 67, 54, 0.15);
            line-height: 1.5;
        }

        .container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 30px;
            width: 100%;
            max-width: 1600px; /* Increased max-width */
        }

        .card {
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
            display: flex;
            flex-direction: column;
            transition: transform var(--transition-speed), box-shadow var(--transition-speed);
        }

        .card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.5);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 10px;
        }

        h2 {
            color: var(--primary-color);
            font-size: 1.9em;
        }

        .toggle-btn {
            background: none;
            border: none;
            color: var(--accent-color);
            font-size: 1.8em;
            cursor: pointer;
            transition: transform var(--transition-speed);
        }

        .card-content.hidden {
            display: none;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: var(--accent-color);
            font-weight: bold;
            font-size: 1.05em;
        }

        input[type="text"],
        textarea,
        select {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            background-color: var(--bg-color);
            border: 1px solid var(--border-color);
            color: var(--text-color);
            border-radius: 6px;
            font-family: var(--font-mono);
            font-size: 1em;
            resize: vertical;
            min-height: 40px;
            transition: border-color var(--transition-speed), box-shadow var(--transition-speed);
        }

        input[type="text"]:focus,
        textarea:focus,
        select:focus {
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(50, 130, 184, 0.3);
            outline: none;
        }

        textarea {
            min-height: 150px;
        }

        button {
            background-color: var(--primary-color);
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1em;
            margin-right: 10px;
            transition: background-color var(--transition-speed), transform 0.1s ease;
            flex-shrink: 0;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        button:hover {
            background-color: var(--accent-color);
            transform: translateY(-2px);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            background-color: #555;
            cursor: not-allowed;
            transform: none;
        }

        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
            margin-bottom: 20px;
        }

        .button-group button.active {
            background-color: var(--accent-color);
            border: 1px solid var(--primary-color);
        }

        .output-area, .results-area {
            background-color: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 15px;
            min-height: 50px;
            margin-top: 15px;
            font-family: var(--font-mono);
            white-space: pre-wrap;
            word-break: break-all;
            position: relative;
            overflow-x: auto; /* For long dork strings */
        }

        .output-area.success-message {
            color: var(--success-color);
        }

        .extracted-list {
            list-style: none;
            padding: 0;
            max-height: 300px;
            overflow-y: auto;
            border-top: 1px solid var(--border-color);
            padding-top: 10px;
            margin-top: 10px;
        }

        .extracted-list h4 {
            color: var(--primary-color);
            margin-bottom: 10px;
            font-size: 1.1em;
            border-bottom: 1px dotted var(--border-color);
            padding-bottom: 5px;
        }

        .extracted-list li {
            padding: 8px 0;
            border-bottom: 1px dotted rgba(255,255,255,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer; /* Make list items clickable */
            transition: background-color 0.2s ease;
        }

        .extracted-list li:hover {
            background-color: rgba(0,0,0,0.2);
        }

        .extracted-list li:last-child {
            border-bottom: none;
        }

        .extracted-list li span {
            word-break: break-all;
            flex-grow: 1;
            padding-right: 10px; /* Space for buttons */
        }

        .extracted-list li button {
            background-color: transparent;
            color: var(--accent-color);
            border: 1px solid var(--accent-color);
            padding: 5px 10px;
            margin-left: 5px;
            font-size: 0.8em;
            transition: background-color var(--transition-speed), color var(--transition-speed);
        }

        .extracted-list li button:hover {
            background-color: var(--accent-color);
            color: white;
        }

        .hint {
            font-size: 0.9em;
            color: var(--info-color);
            margin-bottom: 15px;
            line-height: 1.4;
            display: block;
        }

        .status-message {
            font-size: 0.9em;
            color: var(--info-color);
            margin-top: 10px;
        }

        .error-message {
            color: var(--error-color);
            margin-top: 10px;
        }

        .clipboard-status {
            position: absolute;
            bottom: 5px;
            right: 15px;
            font-size: 0.8em;
            color: var(--success-color);
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }

        .clipboard-status.visible {
            opacity: 1;
        }

        .dork-modifiers {
            margin-top: 15px;
            border-top: 1px solid var(--border-color);
            padding-top: 15px;
        }

        .dork-modifiers label {
            margin-bottom: 10px;
        }

        .dork-modifiers .button-group button {
            background-color: var(--card-bg);
            border: 1px solid var(--accent-color);
            color: var(--accent-color);
            padding: 8px 12px;
            font-size: 0.9em;
        }
        .dork-modifiers .button-group button:hover {
            background-color: var(--accent-color);
            color: var(--card-bg);
        }
        .dork-modifiers .button-group button.active {
            background-color: var(--accent-color);
            color: white;
            border-color: var(--primary-color);
        }

        .custom-regex-section {
            margin-top: 20px;
            border-top: 1px solid var(--border-color);
            padding-top: 20px;
        }

        /* Icons */
        .icon {
            margin-right: 5px;
            width: 1em; /* Adjust based on font size */
            height: 1em;
            vertical-align: middle;
            fill: currentColor; /* Inherit color from parent */
        }
        /* Using Unicode characters for simpler icons */
        .icon-plus::before { content: "\2795"; } /* Heavy plus sign */
        .icon-copy::before { content: "\1F4CB"; } /* Clipboard */
        .icon-open::before { content: "\2197"; } /* North East Arrow */
        .icon-analyze::before { content: "\1F50D"; } /* Magnifying Glass Tilted Left */
        .icon-clear::before { content: "\1F5D1"; } /* Wastebasket */
        .icon-upload::before { content: "\2B06"; } /* Up Arrow */
        .icon-paste::before { content: "\1F4C4"; } /* Page Facing Up */

        /* Responsive adjustments */
        @media (max-width: 1200px) {
            .container {
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            }
        }

        @media (max-width: 900px) {
            .container {
                grid-template-columns: 1fr;
            }
            header h1 {
                font-size: 2.2em;
            }
        }

        @media (max-width: 600px) {
            body {
                padding: 15px;
            }
            header h1 {
                font-size: 1.8em;
            }
            .card {
                padding: 20px;
            }
            h2 {
                font-size: 1.5em;
            }
            button {
                padding: 10px 15px;
                font-size: 0.9em;
                margin-right: 5px;
            }
            .button-group {
                gap: 8px;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>Advanced Dorking & OSINT Workbench</h1>
        <p>Your intelligent, client-side assistant for cybersecurity reconnaissance. Generates context-aware dorks, extracts entities from raw data, and suggests cross-referencing lookups.</p>
        <p class="disclaimer">
            <strong>Disclaimer:</strong> This tool is for ethical cybersecurity research, vulnerability assessment, and legitimate Open Source Intelligence (OSINT).
            Unauthorized access, data exfiltration, or any malicious use of information gained through dorking is illegal and unethical. Use responsibly and adhere to all applicable laws and terms of service.
        </p>
    </header>

    <div class="container">
        <div class="card" id="card-dork-builder">
            <div class="card-header">
                <h2>1. Contextual Dork Builder</h2>
                <button class="toggle-btn" data-target="dork-builder-content">▼</button>
            </div>
            <div class="card-content" id="dork-builder-content">
                <label for="targetInput">Enter Target (Domain, IP, Keyword, or Code Snippet):</label>
                <input type="text" id="targetInput" placeholder="e.g., example.com, 192.168.1.1, MyWebApp, function sensitiveData()">
                <p class="hint">Type in a target, and the system will try to auto-suggest a category. You can also pick manually.</p>

                <label>Target Category:</label>
                <div class="button-group context-options" id="categoryButtons">
                    <button data-category="domain">Domain Recon</button>
                    <button data-category="ip">IP/Network Recon</button>
                    <button data-category="web_app">Web Application</button>
                    <button data-category="code">Code/Secrets</button>
                    <button data-category="files">Sensitive Files</button>
                    <button data-category="social">Social/People OSINT</button>
                </div>
                <p class="status-message" id="categoryAutoDetectStatus"></p>

                <label for="searchEngineSelect">Search Engine:</label>
                <select id="searchEngineSelect">
                    <option value="google">Google</option>
                    <option value="shodan">Shodan</option>
                    <option value="github">GitHub</option>
                    <option value="censys">Censys</option>
                    <option value="ducker">Ducker.com (Experimental)</option>
                </select>

                <div class="dork-modifiers">
                    <label>Add Dork Modifiers:</label>
                    <div class="button-group" id="modifierButtons">
                        <button data-modifier="intitle">intitle:</button>
                        <button data-modifier="inurl">inurl:</button>
                        <button data-modifier="filetype">filetype:</button>
                        <button data-modifier="intext">intext:</button>
                        <button data-modifier="site">site:</button>
                        <button data-modifier="ext">ext:</button>
                        <button data-modifier="link">link:</button>
                        <button data-modifier="OR">OR</button>
                        <button data-modifier="AND">AND</button>
                        <button data-modifier="NOT">-</button>
                    </div>
                </div>

                <label for="generatedDork">Generated Dork:</label>
                <textarea id="generatedDork" rows="3" readonly></textarea>
                <div class="button-group">
                    <button id="copyDorkBtn"><span class="icon icon-copy"></span>Copy Dork</button>
                    <button id="openSearchBtn"><span class="icon icon-open"></span>Open in Search Engine</button>
                </div>
                <div id="copyStatus" class="clipboard-status">Copied!</div>
            </div>
        </div>

        <div class="card" id="card-data-analyzer">
            <div class="card-header">
                <h2>2. Raw Data Analyzer & Entity Extractor</h2>
                <button class="toggle-btn" data-target="data-analyzer-content">▼</button>
            </div>
            <div class="card-content" id="data-analyzer-content">
                <label for="rawDataTextarea">Paste Raw Search Results / Log Snippets / Source Code:</label>
                <textarea id="rawDataTextarea" placeholder="Paste the full text from a search result page, log file, or code here..."></textarea>
                <div class="button-group">
                    <button id="uploadFileBtn"><span class="icon icon-upload"></span>Upload File</button>
                    <input type="file" id="uploadFile" accept=".txt,.log,.html,.json,.xml,.js,.php,.py,.md" style="display: none;">
                    <button id="pasteClipboardBtn"><span class="icon icon-paste"></span>Paste from Clipboard</button>
                    <button id="analyzeDataBtn"><span class="icon icon-analyze"></span>Analyze Data</button>
                    <button id="clearDataBtn"><span class="icon icon-clear"></span>Clear Data</button>
                </div>
                <p class="hint">Upload or paste data to automatically extract key entities. Click extracted entities to cross-reference!</p>
                <p class="status-message" id="analysisStatus"></p>

                <div class="custom-regex-section">
                    <label for="customRegexInput">Custom Regex Pattern (Optional):</label>
                    <input type="text" id="customRegexInput" placeholder="e.g., your_pattern_here">
                    <label for="regexFlags">Regex Flags (g, i, m, etc.):</label>
                    <input type="text" id="regexFlags" value="gi" placeholder="e.g., gi">
                    <button id="applyCustomRegexBtn"><span class="icon icon-plus"></span>Apply Custom Regex</button>
                    <ul id="extractedCustom" class="extracted-list"><h4>Custom Matches:</h4></ul>
                </div>

                <h3>Extracted Entities:</h3>
                <div class="results-area">
                    <ul id="extractedUrls" class="extracted-list"><h4>URLs:</h4></ul>
                    <ul id="extractedIps" class="extracted-list"><h4>IPs:</h4></ul>
                    <ul id="extractedEmails" class="extracted-list"><h4>Emails:</h4></ul>
                    <ul id="extractedCreds" class="extracted-list"><h4>Potential Credentials/Secrets:</h4></ul>
                    <ul id="extractedFiles" class="extracted-list"><h4>Sensitive File Paths:</h4></ul>
                </div>
            </div>
        </div>

        <div class="card" id="card-cross-referencing">
            <div class="card-header">
                <h2>3. Cross-Referencing & New Dork Suggestions</h2>
                <button class="toggle-btn" data-target="cross-referencing-content">▼</button>
            </div>
            <div class="card-content" id="cross-referencing-content">
                <p class="hint">Click on extracted entities from "Raw Data Analyzer" to populate them here and get new dorking and external lookup ideas.</p>

                <label for="selectedEntity">Selected Entity:</label>
                <input type="text" id="selectedEntity" readonly placeholder="No entity selected">

                <label>Suggested Dorks for Selected Entity:</label>
                <div id="suggestedDorksOutput" class="output-area">
                    No entity selected or no specific suggestions.
                </div>

                <label>External Lookup Suggestions:</label>
                <div class="button-group" id="externalLookupButtons">
                    <p id="noLookupSuggestions" class="status-message">Click an entity above to see lookup options.</p>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <p>&copy; 2025 Advanced Dorking & OSINT Workbench. Built with ❤️ and JavaScript.</p>
    </footer>

    <script>
        // --- Core Dorking Logic & Data ---
        const dorkTemplates = {
            google: {
                domain: (target) => `site:${target} intitle:"index of" OR inurl:admin OR filetype:pdf OR filetype:doc`,
                ip: (target) => `intext:"${target}" filetype:log`,
                web_app: (target) => `inurl:${target} OR intitle:${target} filetype:log OR intitle:"${target} admin"`,
                code: (target) => `"${target}" site:github.com OR site:gitlab.com filetype:yml OR filetype:json OR filetype:env`,
                files: (target) => `intitle:"index of" filetype:${target} OR inurl:wp-content ext:${target}`,
                social: (target) => `"${target}" (linkedin.com OR twitter.com OR facebook.com) company:${currentTarget.split('.')[0]}`,
            },
            shodan: {
                domain: (target) => `hostname:"${target}" OR org:"${target}"`,
                ip: (target) => `ip:${target} vuln:true`,
                web_app: (target) => `http.title:"${target}" OR http.component:"${target}"`,
                code: (target) => `"${target}" product:nginx OR product:apache`,
                files: (target) => `http.html:"${target}" filename:credentials`,
                social: (target) => `"${target}"`,
            },
            github: {
                domain: (target) => `"${target}" in:path in:file extension:yml OR extension:json`,
                ip: (target) => `"${target}" in:path in:file extension:env`,
                web_app: (target) => `"${target}" filename:config OR filename:env`,
                code: (target) => `"${target}" in:file language:javascript OR language:python OR language:php`,
                files: (target) => `filename:${target} extension:${target} OR "password" filename:${target}`,
                social: (target) => `user:"${target}" OR "${target}" in:name`,
            },
            censys: {
                domain: (target) => `services.tls.certificates.leaf_data.names:${target} OR certificates.leaf_data.subject.organization:${target}`,
                ip: (target) => `${target} and services.port:80`,
                web_app: (target) => `services.http.response.html_title:"${target}" OR services.http.response.headers.server:"${target}"`,
                code: (target) => `services.http.response.body:"${target}"`,
                files: (target) => `services.http.response.body:"${target}"`,
                social: (target) => `"${target}"`,
            },
            ducker: { // Experimental/Placeholder for future custom search
                domain: (target) => `domain:"${target}"`,
                ip: (target) => `ip:"${target}"`,
                web_app: (target) => `app:"${target}"`,
                code: (target) => `code:"${target}"`,
                files: (target) => `file:"${target}"`,
                social: (target) => `person:"${target}"`,
            }
        };

        const searchEngineUrls = {
            google: 'https://www.google.com/search?q=',
            shodan: 'https://www.shodan.io/search?query=',
            github: 'https://github.com/search?q=',
            censys: 'https://search.censys.io/search?resource=hosts&q=',
            ducker: 'https://example.com/ducker-search?q=' // Placeholder URL for Ducker
        };

        const commonDorkModifiers = {
            intitle: 'intitle:', inurl: 'inurl:', filetype: 'filetype:', intext: 'intext:',
            site: 'site:', ext: 'ext:', link: 'link:', OR: 'OR', AND: 'AND', NOT: '-'
        };

        const sensitiveFileExtensions = 'txt|pdf|doc|docx|xls|xlsx|ppt|pptx|zip|rar|7z|sql|bak|log|config|conf|ini|env|json|xml|yaml|yml|sh|bash|zsh|ps1|csv|htaccess|htpasswd|git|svn|hg|id_rsa|id_dsa|id_ecdsa|id_ed25519'; // Added common private key names

        const regexPatterns = {
            urls: /(https?:\/\/[^\s"',;<>]+)/g,
            ips: /\b(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\b/g,
            emails: /\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b/g,
            creds: /(?:password|pwd|secret|key|token|api_key|auth|credential|username|pass|passwd|private_key|client_secret|access_token|bearer|aws_access_key_id|aws_secret_access_key|s3_bucket)\s*[:=]\s*['"]?([a-zA-Z0-9_\-\.!@#$%^&*()_+={}\[\]|;:'",<>\/?`~]+)['"]?/gi,
            files: new RegExp(`(?:filetype:|ext:|[\\/](?:etc|var|opt|proc|dev|tmp|root|home|backup|admin|config|logs)[\\/]|\\.(?:${sensitiveFileExtensions}))(?:[\\w\\-. ]+\\/?)*`, 'gi'),
            s3buckets: /(?:s3|bucket|aws)\.(?:amazonaws\.com|s3|cloudfront)\/[\w.-]+/gi,
            apikeys: /(?:AKIA[0-9A-Z]{16}|SKIA[0-9A-Z]{16}|SG\.[\w-]{10,}|pk_live_[a-zA-Z0-9]{32}|rk_live_[a-zA-Z0-9]{32}|sk_live_[a-zA-Z0-9]{32}|sq0csp-[a-zA-Z0-9-_]{43}|xoxb-[0-9]{12}-[0-9]{12,})/g // Added common API key formats
        };


        // --- DOM Elements ---
        const targetInput = document.getElementById('targetInput');
        const categoryButtons = document.getElementById('categoryButtons').querySelectorAll('button');
        const searchEngineSelect = document.getElementById('searchEngineSelect');
        const generatedDork = document.getElementById('generatedDork');
        const copyDorkBtn = document.getElementById('copyDorkBtn');
        const openSearchBtn = document.getElementById('openSearchBtn');
        const copyStatus = document.getElementById('copyStatus');
        const categoryAutoDetectStatus = document.getElementById('categoryAutoDetectStatus');
        const modifierButtons = document.getElementById('modifierButtons').querySelectorAll('button');

        const rawDataTextarea = document.getElementById('rawDataTextarea');
        const uploadFile = document.getElementById('uploadFile');
        const uploadFileBtn = document.getElementById('uploadFileBtn');
        const pasteClipboardBtn = document.getElementById('pasteClipboardBtn');
        const analyzeDataBtn = document.getElementById('analyzeDataBtn');
        const clearDataBtn = document.getElementById('clearDataBtn');
        const analysisStatus = document.getElementById('analysisStatus');
        const customRegexInput = document.getElementById('customRegexInput');
        const regexFlagsInput = document.getElementById('regexFlags');
        const applyCustomRegexBtn = document.getElementById('applyCustomRegexBtn');

        const extractedUrlsList = document.getElementById('extractedUrls');
        const extractedIpsList = document.getElementById('extractedIps');
        const extractedEmailsList = document.getElementById('extractedEmails');
        const extractedCredsList = document.getElementById('extractedCreds');
        const extractedFilesList = document.getElementById('extractedFiles');
        const extractedCustomList = document.getElementById('extractedCustom');

        const selectedEntityInput = document.getElementById('selectedEntity');
        const suggestedDorksOutput = document.getElementById('suggestedDorksOutput');
        const externalLookupButtons = document.getElementById('externalLookupButtons');
        const noLookupSuggestions = document.getElementById('noLookupSuggestions');

        const cardToggleButtons = document.querySelectorAll('.toggle-btn');

        // --- State Variables ---
        let currentTarget = '';
        let currentCategory = '';
        let activeModifiers = new Set();
        let extractedEntities = {
            urls: [], ips: [], emails: [], creds: [], files: [], custom: []
        };
        let sessionState = { // Use a more descriptive name for state
            target: '',
            category: '',
            engine: 'google',
            modifiers: []
        };

        // --- UI/UX Enhancements ---
        cardToggleButtons.forEach(button => {
            button.addEventListener('click', () => {
                const targetId = button.dataset.target;
                const targetContent = document.getElementById(targetId);
                const isHidden = targetContent.classList.toggle('hidden');
                button.textContent = isHidden ? '▶' : '▼';
            });
        });

        function showStatus(element, message, type = 'info', duration = 3000) {
            element.textContent = message;
            element.className = `status-message ${type}-message`; // Resets classes and adds new one
            setTimeout(() => {
                element.textContent = '';
                element.className = 'status-message';
            }, duration);
        }

        function showCopyStatus(message = 'Copied!') {
            copyStatus.textContent = message;
            copyStatus.classList.add('visible');
            setTimeout(() => copyStatus.classList.remove('visible'), 1500);
        }

        // --- Functions for Contextual Dork Builder ---
        function detectCategory(target) {
            target = target.toLowerCase();
            if (!target) return '';
            if (regexPatterns.ips.test(target)) return 'ip';
            // More robust domain check: must contain at least one dot, not start/end with dot/dash, and minimal length
            if (target.includes('.') && !target.startsWith('.') && !target.endsWith('.') && target.length > 5 && !target.includes(' ')) return 'domain';
            if (target.includes('function ') || target.includes('var ') || target.includes('const ') || target.includes('def ') || target.includes('class ') || target.includes('<?php')) return 'code';
            if (target.includes('admin') || target.includes('login') || target.includes('dashboard') || target.includes('panel')) return 'web_app';
            if (target.includes('password') || target.includes('secret') || target.includes('key') || target.includes('token') || target.includes('credential')) return 'code'; // Treat credentials as code/secrets
            if (target.includes('pdf') || target.includes('doc') || target.includes('log') || target.includes('sql') || target.includes('env') || target.includes('zip')) return 'files';
            if (target.includes('@')) return 'social'; // Could be an email for social lookup
            return '';
        }

        function updateGeneratedDork() {
            const engine = searchEngineSelect.value;
            const target = targetInput.value.trim();
            currentTarget = target; // Update global state for templates
            sessionState.target = target;
            sessionState.engine = engine;
            sessionState.modifiers = Array.from(activeModifiers); // Save active modifiers
            saveState();

            // Auto-detect category if not manually set
            if (!currentCategory && target) {
                const detected = detectCategory(target);
                if (detected) {
                    currentCategory = detected;
                    sessionState.category = currentCategory; // Save detected category
                    highlightCategoryButton(document.querySelector(`button[data-category="${detected}"]`));
                    showStatus(categoryAutoDetectStatus, `Auto-detected category: ${detected.replace('_', ' ')}`, 'info', 2000);
                } else {
                    highlightCategoryButton(null);
                    showStatus(categoryAutoDetectStatus, '', 'info');
                }
            } else if (!target) {
                currentCategory = '';
                sessionState.category = '';
                highlightCategoryButton(null);
                showStatus(categoryAutoDetectStatus, '', 'info');
            }


            let baseDork = "";
            if (target && currentCategory && dorkTemplates[engine] && dorkTemplates[engine][currentCategory]) {
                baseDork = dorkTemplates[engine][currentCategory](target);
            } else if (target && engine) {
                // Fallback generic dork if no specific category or template
                baseDork = `"${target}"`;
                if (engine === 'google') baseDork = `"${target}" site:linkedin.com OR site:github.com OR site:gitlab.com OR inurl:${target}`;
                else if (engine === 'shodan') baseDork = `"${target}"`;
                else if (engine === 'github') baseDork = `"${target}" in:file`;
                else if (engine === 'censys') baseDork = `"${target}"`;
            }

            // Apply active modifiers
            let dorkParts = [baseDork];
            activeModifiers.forEach(mod => {
                const operator = commonDorkModifiers[mod];
                // Check if the baseDork already implicitly contains this operator
                // This is a simple check and might not catch all cases, but prevents obvious duplicates
                if (baseDork.includes(operator) || (mod === 'NOT' && baseDork.includes('-'))) {
                    return; // Skip if already present
                }
                if (mod === 'OR' || mod === 'AND' || mod === 'NOT') {
                    dorkParts.push(operator);
                } else {
                    dorkParts.push(operator); // Add the operator, user needs to type the value
                }
            });

            // Clean up multiple boolean operators if they appear consecutively without context
            let finalDork = dorkParts.join(' ').trim();
            finalDork = finalDork.replace(/(OR|AND)\s+(OR|AND)/g, '$1'); // Replace 'OR OR' with 'OR'
            finalDork = finalDork.replace(/-{2,}/g, '-'); // Replace '--' with '-'

            generatedDork.value = finalDork;
        }

        function highlightCategoryButton(selectedBtn) {
            categoryButtons.forEach(btn => btn.classList.remove('active'));
            if (selectedBtn) {
                selectedBtn.classList.add('active');
            }
        }

        function highlightModifierButton(modifier) {
            modifierButtons.forEach(btn => {
                if (btn.dataset.modifier === modifier) {
                    btn.classList.toggle('active', activeModifiers.has(modifier));
                }
            });
        }

        function toggleModifier(button, modifier) {
            if (activeModifiers.has(modifier)) {
                activeModifiers.delete(modifier);
            } else {
                activeModifiers.add(modifier);
            }
            highlightModifierButton(modifier);
            updateGeneratedDork();
        }

        // Event Listeners for Dork Builder
        categoryButtons.forEach(button => {
            button.addEventListener('click', () => {
                currentCategory = button.dataset.category;
                sessionState.category = currentCategory; // Save selected category
                highlightCategoryButton(button);
                updateGeneratedDork();
            });
        });

        modifierButtons.forEach(button => {
            button.addEventListener('click', () => {
                toggleModifier(button, button.dataset.modifier);
            });
        });

        targetInput.addEventListener('input', () => {
            // Reset category on target input change only if it wasn't manually set
            // to allow auto-detection to run again
            if (!sessionState.category || sessionState.target !== targetInput.value.trim()) {
                currentCategory = '';
                sessionState.category = '';
            }
            updateGeneratedDork();
        });
        searchEngineSelect.addEventListener('change', updateGeneratedDork);

        copyDorkBtn.addEventListener('click', () => {
            navigator.clipboard.writeText(generatedDork.value)
                .then(() => showCopyStatus())
                .catch(err => showStatus(copyStatus, 'Failed to copy!', 'error'));
        });

        openSearchBtn.addEventListener('click', () => {
            const dork = generatedDork.value;
            const engine = searchEngineSelect.value;
            const baseUrl = searchEngineUrls[engine];
            if (dork && baseUrl) {
                window.open(baseUrl + encodeURIComponent(dork), '_blank');
            } else {
                showStatus(generatedDork, "Please generate a dork first.", 'error');
            }
        });

        // --- Functions for Raw Data Analyzer ---
        function createExtractedListItem(item, type) {
            const li = document.createElement('li');
            const span = document.createElement('span');
            span.textContent = item;
            span.title = `Click to select '${item}' for cross-referencing`;
            li.appendChild(span);

            const copyBtn = document.createElement('button');
            copyBtn.innerHTML = '📋 Copy';
            copyBtn.onclick = (e) => {
                e.stopPropagation(); // Prevent li click event from bubbling
                navigator.clipboard.writeText(item);
                copyBtn.textContent = 'Copied!';
                setTimeout(() => copyBtn.innerHTML = '📋 Copy', 1000);
            };
            li.appendChild(copyBtn);

            li.onclick = () => selectEntity(item);
            return li;
        }

        function displayExtractedEntities(type, listElement, data) {
            listElement.innerHTML = `<h4>${listElement.querySelector('h4').textContent}</h4>`; // Preserve title
            if (data.length === 0) {
                const li = document.createElement('li');
                li.textContent = `No ${type} found.`;
                li.style.fontStyle = 'italic';
                li.style.cursor = 'default';
                listElement.appendChild(li);
                return;
            }
            data.forEach(item => {
                listElement.appendChild(createExtractedListItem(item, type));
            });
        }

        function analyzeRawData() {
            const rawData = rawDataTextarea.value;
            if (!rawData) {
                showStatus(analysisStatus, "Please paste or upload data to analyze.", 'error');
                clearExtractedLists();
                return;
            }

            analysisStatus.textContent = "";
            extractedEntities = { urls: [], ips: [], emails: [], creds: [], files: [], custom: [] };

            extractedEntities.urls = [...new Set(rawData.match(regexPatterns.urls) || [])];
            extractedEntities.ips = [...new Set(rawData.match(regexPatterns.ips) || [])];
            extractedEntities.emails = [...new Set(rawData.match(regexPatterns.emails) || [])];

            // Complex Credential/Secret Extraction
            const credMatches = rawData.match(regexPatterns.creds) || [];
            credMatches.forEach(match => {
                const parts = match.split(/[:=]/);
                let value = match; // Default to full match
                if (parts.length > 1) {
                    value = parts.slice(1).join(':').trim().replace(/['"]/g, '');
                }
                if (value.length > 0 && !extractedEntities.creds.includes(value)) {
                    extractedEntities.creds.push(value);
                }
            });
            // Add S3 buckets and API keys directly to creds as they are sensitive
            [...new Set(rawData.match(regexPatterns.s3buckets) || [])].forEach(match => { if(!extractedEntities.creds.includes(match)) extractedEntities.creds.push(match); });
            [...new Set(rawData.match(regexPatterns.apikeys) || [])].forEach(match => { if(!extractedEntities.creds.includes(match)) extractedEntities.creds.push(match); });


            const fileMatches = rawData.match(regexPatterns.files) || [];
            extractedEntities.files = [...new Set(fileMatches)];

            displayExtractedEntities('URLs', extractedUrlsList, extractedEntities.urls);
            displayExtractedEntities('IPs', extractedIpsList, extractedEntities.ips);
            displayExtractedEntities('Emails', extractedEmailsList, extractedEntities.emails);
            displayExtractedEntities('Potential Credentials', extractedCredsList, extractedEntities.creds);
            displayExtractedEntities('Sensitive Files/Paths', extractedFilesList, extractedEntities.files);

            showStatus(analysisStatus, "Analysis complete. Found " +
                (extractedEntities.urls.length + extractedEntities.ips.length + extractedEntities.emails.length +
                 extractedEntities.creds.length + extractedEntities.files.length) + " entities.", 'success');
        }

        function clearExtractedLists() {
            extractedUrlsList.innerHTML = `<h4>URLs:</h4>`;
            extractedIpsList.innerHTML = `<h4>IPs:</h4>`;
            extractedEmailsList.innerHTML = `<h4>Emails:</h4>`;
            extractedCredsList.innerHTML = `<h4>Potential Credentials/Secrets:</h4>`;
            extractedFilesList.innerHTML = `<h4>Sensitive File Paths:</h4>`;
            extractedCustomList.innerHTML = `<h4>Custom Matches:</h4>`; // Clear custom too
            showStatus(analysisStatus, "Data cleared.", 'info');
            selectEntity(''); // Clear selected entity in cross-referencing
        }

        uploadFileBtn.addEventListener('click', () => uploadFile.click());
        uploadFile.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    rawDataTextarea.value = e.target.result;
                    analyzeRawData();
                };
                reader.onerror = (e) => {
                    showStatus(analysisStatus, `Error reading file: ${e.target.error}`, 'error');
                };
                reader.readAsText(file);
            }
        });

        pasteClipboardBtn.addEventListener('click', async () => {
            try {
                const text = await navigator.clipboard.readText();
                rawDataTextarea.value = text;
                analyzeRawData();
                showStatus(analysisStatus, "Pasted from clipboard and analyzed.", 'success');
            } catch (err) {
                showStatus(analysisStatus, "Failed to read from clipboard. Ensure permission is granted.", 'error');
                console.error('Failed to read clipboard contents: ', err);
            }
        });

        applyCustomRegexBtn.addEventListener('click', () => {
            const pattern = customRegexInput.value;
            const flags = regexFlagsInput.value;
            if (!pattern) {
                showStatus(extractedCustomList, "Please enter a regex pattern.", 'error');
                extractedCustomList.innerHTML = `<h4>Custom Matches:</h4><li>No pattern entered.</li>`;
                return;
            }
            try {
                const customRegex = new RegExp(pattern, flags);
                const rawData = rawDataTextarea.value;
                const matches = [...new Set(rawData.match(customRegex) || [])];
                extractedEntities.custom = matches;
                displayExtractedEntities('Custom Matches', extractedCustomList, matches);
                showStatus(extractedCustomList, `Applied custom regex. Found ${matches.length} matches.`, 'success');
            } catch (e) {
                showStatus(extractedCustomList, `Invalid regex: ${e.message}`, 'error');
                extractedCustomList.innerHTML = `<h4>Custom Matches:</h4><li>Invalid regex pattern.</li>`;
            }
        });

        // --- Functions for Cross-Referencing ---
        function selectEntity(entity) {
            selectedEntityInput.value = entity;
            suggestDorksForEntity(entity);
            suggestExternalLookups(entity);
            // Optionally scroll to cross-referencing section and expand it
            const crossRefCard = document.getElementById('card-cross-referencing');
            const crossRefContent = document.getElementById('cross-referencing-content');
            if (crossRefContent.classList.contains('hidden')) {
                crossRefContent.classList.remove('hidden');
                crossRefCard.querySelector('.toggle-btn').textContent = '▼';
            }
            crossRefCard.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function suggestDorksForEntity(entity) {
            suggestedDorksOutput.innerHTML = ''; // Clear previous suggestions
            if (!entity) {
                suggestedDorksOutput.textContent = 'No entity selected or no specific suggestions.';
                return;
            }

            const suggestions = [];
            const isIP = regexPatterns.ips.test(entity);
            const isDomain = !isIP && entity.includes('.'); // Basic check for domain
            const isEmail = regexPatterns.emails.test(entity);

            // Core Suggestions
            if (isDomain) {
                suggestions.push(`Google: site:${entity} intitle:"index of" (log|conf|backup|db)`);
                suggestions.push(`Shodan: hostname:"${entity}" OR org:"${entity}"`);
                suggestions.push(`GitHub: "${entity}" in:path in:file extension:yml OR extension:json OR extension:env`);
                suggestions.push(`Censys: certificates.leaf_data.names:${entity} OR certificates.leaf_data.subject.organization:${entity}`);
            } else if (isIP) {
                suggestions.push(`Shodan: ip:${entity} port:80,443,22,3389 vuln:true`);
                suggestions.push(`Censys: ${entity} and services.port:80`);
                suggestions.push(`Google: intext:"${entity}" intitle:"dashboard"`);
            } else if (isEmail) {
                suggestions.push(`Google: "${entity}" inurl:pastebin OR inurl:leak OR inurl:dump`);
                suggestions.push(`GitHub: "${entity}" in:file language:python OR language:javascript`);
                suggestions.push(`Google: "${entity}" site:linkedin.com OR site:twitter.com`);
            } else if (entity.length > 5 && (entity.includes(' ') || entity.includes('_') || entity.includes('-'))) { // Likely a phrase or name
                 suggestions.push(`Google: "${entity}" site:linkedin.com OR site:twitter.com OR site:crunchbase.com`);
                 suggestions.push(`Google: "${entity}" company.com filetype:pdf OR filetype:doc`);
                 suggestions.push(`GitHub: "${entity}" in:readme`);
            } else if (entity.length > 3) { // Generic keyword/code snippet/file name
                suggestions.push(`Google: "${entity}" site:github.com OR site:gitlab.com`);
                suggestions.push(`Shodan: http.title:"${entity}" OR http.html:"${entity}"`);
                suggestions.push(`GitHub: "${entity}" in:file extension:js OR extension:php OR extension:py`);
                suggestions.push(`Google: intitle:"index of" "${entity}"`);
            }
            // Add specific sensitive data patterns
            if (regexPatterns.apikeys.test(entity) || regexPatterns.s3buckets.test(entity)) {
                suggestions.push(`Google: "${entity}" inurl:pastebin OR inurl:gist OR intext:leak`);
                suggestions.push(`GitHub: "${entity}" in:file`);
            }

            // Fuzzy/Related Dork Suggestions
            if (isDomain) {
                const parts = entity.split('.');
                if (parts.length >= 2) {
                    suggestions.push(`Google: site:*.${parts.slice(1).join('.')} intitle:"${parts[0]}"`); // Subdomain dorking
                }
            } else if (isIP) {
                 const ipParts = entity.split('.');
                 if (ipParts.length === 4) {
                     suggestions.push(`Shodan: net:${ipParts[0]}.${ipParts[1]}.0.0/16`); // CIDR for Shodan
                     suggestions.push(`Google: intext:"${ipParts[0]}.${ipParts[1]}" filetype:log`); // Search for partial IP
                 }
            }


            if (suggestions.length === 0) {
                suggestedDorksOutput.textContent = 'No specific dork suggestions for this entity type.';
                return;
            }

            const ul = document.createElement('ul');
            suggestions.forEach(sug => {
                const li = document.createElement('li');
                li.style.marginBottom = '5px';
                li.style.fontFamily = 'var(--font-mono)';
                li.style.color = 'var(--text-color)';
                li.style.cursor = 'default';

                const dorkText = document.createElement('span');
                dorkText.textContent = sug;
                li.appendChild(dorkText);

                const copyBtn = document.createElement('button');
                copyBtn.innerHTML = '📋 Copy';
                copyBtn.style.marginLeft = '10px';
                copyBtn.style.backgroundColor = 'transparent';
                copyBtn.style.color = 'var(--accent-color)';
                copyBtn.style.border = '1px solid var(--accent-color)';
                copyBtn.style.padding = '3px 8px';
                copyBtn.style.fontSize = '0.75em';
                copyBtn.onclick = () => {
                    navigator.clipboard.writeText(sug.split(': ').slice(1).join(': ')); // Copy only the dork after "Engine: "
                    copyBtn.textContent = 'Copied!';
                    setTimeout(() => copyBtn.innerHTML = '📋 Copy', 1000);
                };
                li.appendChild(copyBtn);

                ul.appendChild(li);
            });
            suggestedDorksOutput.appendChild(ul);
        }

        function suggestExternalLookups(entity) {
            externalLookupButtons.innerHTML = ''; // Clear previous buttons
            noLookupSuggestions.style.display = 'block';

            const addLookupButton = (text, urlTemplate) => {
                const btn = document.createElement('button');
                btn.textContent = text;
                btn.onclick = () => window.open(urlTemplate.replace('{{ENTITY}}', encodeURIComponent(entity)), '_blank');
                externalLookupButtons.appendChild(btn);
                noLookupSuggestions.style.display = 'none';
            };

            const isIP = regexPatterns.ips.test(entity);
            const isDomain = !isIP && entity.includes('.');
            const isEmail = regexPatterns.emails.test(entity);

            if (isIP) {
                addLookupButton('VirusTotal (IP)', `https://www.virustotal.com/gui/ip-address/{{ENTITY}}/detection`);
                addLookupButton('AbuseIPDB', `https://www.abuseipdb.com/check/{{ENTITY}}`);
                addLookupButton('Cymru IP to ASN', `https://whois.cymru.com/cgi-bin/whois.cgi?query={{ENTITY}}`);
                addLookupButton('Censys (IP)', `https://search.censys.io/search?resource=hosts&q={{ENTITY}}`);
            }
            if (isDomain) {
                addLookupButton('VirusTotal (Domain)', `https://www.virustotal.com/gui/domain/{{ENTITY}}/detection`);
                addLookupButton('WHOIS Lookup', `https://who.is/whois/{{ENTITY}}`);
                addLookupButton('crt.sh (Certificates)', `https://crt.sh/?q=%25.{{ENTITY}}`);
                addLookupButton('DNSDumpster', `https://dnsdumpster.com/${entity}`);
                addLookupButton('Sublist3r (Online)', `https://sublist3r.com/online/index.php?domain={{ENTITY}}`);
                addLookupButton('Wayback Machine', `https://web.archive.org/web/*/{{ENTITY}}`);
            }
            if (isEmail) {
                addLookupButton('HaveIBeenPwned?', `https://haveibeenpwned.com/unified/{{ENTITY}}`);
                addLookupButton('Hunter.io (Email verify)', `https://hunter.io/email-verifier/{{ENTITY}}`);
                addLookupButton('Google Dork (Email)', `https://www.google.com/search?q=%22{{ENTITY}}%22+inurl:pastebin+OR+inurl:leak`);
            }
            // Generic lookup for any text that might be an exploit/vulnerability name or sensitive string
            if (!isIP && !isDomain && !isEmail && entity.length > 5) {
                addLookupButton('Exploit-DB', `https://www.exploit-db.com/search?q={{ENTITY}}`);
                addLookupButton('PacketStorm (Exploits)', `https://packetstormsecurity.com/search/?q={{ENTITY}}`);
                if (regexPatterns.apikeys.test(entity) || regexPatterns.s3buckets.test(entity)) {
                    addLookupButton('AWS Console (Manual Check)', `https://console.aws.amazon.com/`); // Direct link, user must check manually
                }
            }

            if (externalLookupButtons.children.length === 0) {
                 noLookupSuggestions.style.display = 'block';
            }
        }

        // --- Session Persistence (localStorage) ---
        function saveState() {
            localStorage.setItem('dorkWorkbenchState', JSON.stringify(sessionState));
        }

        function loadState() {
            const savedState = localStorage.getItem('dorkWorkbenchState');
            if (savedState) {
                const loaded = JSON.parse(savedState);
                sessionState = { ...sessionState, ...loaded }; // Merge loaded state
                targetInput.value = sessionState.target || '';
                searchEngineSelect.value = sessionState.engine || 'google';
                currentCategory = sessionState.category || ''; // Set currentCategory from loaded state

                if (currentCategory) {
                    const btn = document.querySelector(`button[data-category="${currentCategory}"]`);
                    if (btn) highlightCategoryButton(btn);
                }

                activeModifiers.clear();
                if (sessionState.modifiers && Array.isArray(sessionState.modifiers)) {
                    sessionState.modifiers.forEach(mod => {
                        activeModifiers.add(mod);
                        highlightModifierButton(mod);
                    });
                }
            }
        }

        // --- Initial setup ---
        loadState(); // Load state first
        updateGeneratedDork(); // Generate initial dork based on loaded or default state
        clearExtractedLists(); // Clear lists on load
        noLookupSuggestions.style.display = 'block'; // Ensure it's visible initially
    </script>
</body>
</html>